pub struct Solution;

use std::collections::HashMap;
// 给定一个含有不同整数的数组，计算满足 a * b = c * d 且 a != b != c != d 的元组
// 的个数。
//
// 遍历二元组 (a, b)，其乘积 product，若 map 中有相同的 product, 则 += 8 * product_count
// 再把 product 放到 map 中, 检查后再放，避免重复
impl Solution {
    pub fn tuple_same_product(nums: Vec<i32>) -> i32 {
        let mut m = HashMap::new();
        let mut c = 0;
        for i in 0..nums.len() {
            for j in i + 1..nums.len() {
                let product = nums[i] * nums[j];
                if let Some(product_count) = m.get(&product) {
                    c += 8 * product_count;
                }
                m.entry(product)
                    .and_modify(|product_count| *product_count += 1)
                    .or_insert(1);
            }
        }
        c
    }
}

#[cfg(test)]
mod test {
    use super::Solution;
    #[test]
    fn test_example() {
        assert_eq!(Solution::tuple_same_product(vec![2, 3, 4, 6]), 8);
        assert_eq!(Solution::tuple_same_product(vec![1, 2, 4, 5, 10]), 16);
        assert_eq!(
            Solution::tuple_same_product(vec![
                775, 3712, 7178, 690, 2318, 5016, 854, 7742, 1067, 3551, 6305, 5346, 5254, 6474,
                7505, 7980, 4899, 7680, 4154, 4116, 1394, 1922, 4316, 224, 715, 319, 710, 5368,
                2009, 1424, 3655, 5460, 7735, 4004, 3105, 7565, 2115, 7553, 6156, 3752, 352, 1827,
                6216, 4455, 21, 4180, 1680, 5865, 1700, 6880, 3872, 2024, 1230, 1638, 935, 4094,
                6188, 4026, 804, 4959, 6596, 782, 6664, 4876, 1755, 1120, 320, 6700, 4000, 1628,
                1210, 5115, 1602, 4059, 190, 7900, 8051, 4897, 5980, 8360, 1136, 106, 5063, 4232,
                16, 6660, 4557, 6512, 1050, 912, 2673, 3220, 4712, 6566, 7161, 146, 2920, 1078,
                434, 4257, 318, 4560, 6204, 8624, 7584, 2590, 2291, 1881, 5546, 4056, 539, 6860,
                1271, 682, 295, 5076, 2765, 2312, 5766, 4512, 2688, 1914, 378, 2628, 3520, 1278,
                5429, 219, 2006, 567, 777, 6375, 5330, 1422, 3672, 3444, 1092, 4160, 7470, 161,
                2597, 336, 10, 365, 5103, 2190, 2268, 456, 1353, 4410, 259, 2240, 8148, 4092, 672,
                1290, 536, 2848, 7128, 1156, 286, 4816, 518, 225, 8924, 5626, 8075, 3450, 2130,
                2030, 249, 550, 5695, 4556, 3185, 9700, 2891, 6164, 3408, 2684, 415, 2294, 6853,
                3283, 265, 5917, 832, 5382, 96, 7743, 3456, 112, 1780, 89, 793, 1220, 4958, 4982,
                1672, 750, 3854, 3102, 341, 8500, 4488, 1794, 1125, 344, 2379, 4720, 2109, 3905,
                5415, 5440, 418, 8820, 3995, 5112, 5518, 1420, 5723, 5073, 1110, 1260, 2650, 1519,
                1034, 2808, 238, 3212, 4840, 4331, 6497, 196, 5520, 4539, 876, 48, 1771, 5244,
                6468, 612, 3956, 1040, 4860, 3007, 4085, 38, 2146, 7216, 1246, 494, 4653, 6072,
                2928, 1350, 4350, 960, 3538, 2133, 1880, 3393, 5229, 1175, 7896, 2816, 3328, 3366,
                2232, 2116, 5880, 35, 474, 1458, 2867, 891, 4400, 351, 7290, 1984, 5475, 1702, 795,
                4582, 2976, 2170, 4543, 8640, 736, 68, 159, 322, 637, 4389, 3243, 2185, 170, 4070,
                316, 9009, 1334, 4288, 1131, 2072, 1564, 2450, 3783, 4611, 4371, 1666, 575, 6460,
                2560, 4875, 498, 4640, 3484, 4888, 688, 814, 3840, 245, 37, 1265, 6435, 3999, 2158,
                616, 2074, 4590, 5680, 497, 4380, 5175, 6555, 45, 3053, 7663, 2346, 135, 4416,
                1184, 3880, 1225, 7296, 2700, 7275, 3570, 5427, 3575, 3895, 5032, 7524, 3159, 1485,
                4794, 3172, 2805, 6525, 594, 266, 235, 6, 3588, 2624, 4171, 611, 3318, 5700, 5060,
                2212, 5795, 5829, 1836, 2520, 2465, 4505, 2040, 2698, 3128, 6461, 1520, 2352, 2538,
                798, 1975, 1696, 374, 171, 9024, 636, 1150, 3276, 4158, 790, 2860, 5976, 4368,
                6942, 1475, 188, 8280, 168, 952, 5775, 5916, 1575, 639, 1121, 3350, 8099, 3996,
                5376, 4235, 602, 6230, 980, 1134, 5940, 4692, 1496, 4266, 7007, 3510, 946, 1620,
                1776, 2310, 3864, 1060, 3933, 938, 3355, 6080, 1421, 5950, 437, 369, 3627, 3145,
                207, 2340, 4700, 1708, 3245, 1296, 1196, 8036, 1100, 2275, 780, 6840, 1541, 848,
                940, 2709, 4032, 4980, 166, 2405, 7252, 2117, 4189, 8134, 6424, 2254, 5184, 2993,
                6141, 3306, 522, 4029, 820, 27, 217, 6440, 603, 4779, 6400, 7566, 4272, 8827, 162,
                847, 4656, 180, 67, 3819, 589, 665, 4182, 7221, 2010, 1920, 20, 1168, 1647, 826,
                8712, 1887, 580, 189, 5610, 6935, 4895, 2380, 5396, 3358, 4675, 608, 1891, 2365,
                728, 1305, 36, 2905, 5208, 6650, 4806, 969, 2214, 126, 1804, 6808, 1081, 735, 3774,
                1035, 4508, 4636, 5785, 9000, 819, 363, 5250, 640, 57, 6175, 63, 3750, 1242, 462,
                9108, 590, 1876, 6825, 4340, 1748, 2301, 52, 3196, 4352, 128, 194, 392, 380, 799,
                2394, 5810, 3483, 6270, 592, 1176, 1736, 3256, 5148, 3871, 2418, 649, 1558, 825,
                3796, 1548, 6557, 493, 1566, 2176, 5525, 6745, 527, 2021, 7614, 5336, 5044, 4332,
                4095, 3286, 468, 2331, 1058, 95, 6794, 3835, 3540, 4366, 6552, 5874, 4818, 4984,
                423, 91, 3, 2911, 1552, 1785, 610, 5684, 2400, 2806, 3569, 1525, 4576, 5984, 79,
                6314, 6097, 852, 1936, 6975, 2231, 7052, 8536, 2623, 2090, 2812, 2760, 869, 3248,
                7520, 6192, 1209, 2233, 333, 445, 1323, 6162, 33, 495, 568, 342, 4131, 2263, 442,
                1701, 5590, 4600, 1826, 984, 6560, 6790, 1221, 979, 913, 1276, 2392, 3157, 2714,
                2625, 737, 1440, 732, 43, 6912, 7332, 164, 19, 1001, 448, 6052, 3410, 391, 3337,
                1189, 760, 2257, 2610, 3233, 8217, 2580, 574, 2432, 6300, 1071, 4617, 1551, 875,
                7488, 6699, 2322, 3584, 5166, 3465, 1407, 4452, 3818, 5510, 2553, 5934, 2272, 429,
                4680, 3320, 1472, 3953, 950, 4118, 663, 9300, 1288, 1261, 4473, 4850, 138, 2960,
                3528, 279, 1643, 4484, 1372, 4472, 2774, 5841, 3731, 8832, 544, 51, 1080, 116, 435,
                3927, 9200, 4968, 1452, 2201, 1476, 1798, 5600, 305, 1813, 4914, 8918, 897, 3800,
                3388, 1083, 7360, 2613, 1178, 7068, 2838, 696, 1740, 6004, 2581, 830, 3154, 8463,
                5328, 2736, 192, 6399, 1855, 2907, 4361, 3400, 2150, 4750, 22, 1416, 7708, 4020,
                6750, 924, 945, 4067, 6768, 8277, 6715, 3792, 4134, 3773, 11, 1456, 1075, 2744,
                213, 8400, 6586, 1625, 7452, 781, 472, 240, 216, 2075, 6336, 3922, 5607, 5640,
                5248, 874, 2550, 1505, 2142, 4928, 1105, 2829, 582, 5046, 2706, 5481, 370, 4920,
                4148, 2244, 1856, 957, 496, 7020, 310, 270, 2067, 315, 2079, 6111, 1183, 74, 4998,
                987, 460, 6732, 3026, 3828, 6723, 1014, 6432, 134, 4002, 42, 410, 629, 1608, 142,
                3432, 8188, 2120, 3230, 308, 97, 903, 6110, 4851, 4408, 5696, 840, 7081, 1664,
                1824, 8730, 1953, 5529, 425, 1455, 1612, 5978, 4810, 1426, 870, 2077, 1274, 3354,
                6862, 2242, 792, 2088, 7476, 6478, 5643, 7968, 828, 2415, 3500, 511, 5852, 3990,
                4690, 1722, 3660, 297, 153, 291, 867, 1935, 2967, 6020, 6138, 209, 9100, 7954,
                3904, 2990, 1820, 1598, 1739, 4599, 3965, 152, 1825, 3599, 1488, 671, 1222, 666,
                5312, 464, 552, 2419, 237, 7656, 8835, 2925, 528, 7008, 8342, 7350, 2886, 5220,
                2226, 7728, 1890, 3016, 7098, 2485, 632, 4240, 3397, 248, 2666, 6365, 5002, 8600,
                3975, 1539, 3239, 5162, 871, 8366, 5200, 1568, 3010, 5146, 4176, 609, 578, 8000,
                2646, 201, 752, 779, 1742, 2926, 144, 3536, 4, 2541, 8900, 5070, 2703, 1767, 140,
                6006, 5313, 5451, 5530, 2277, 6640, 1200, 4234, 3652, 510, 4140, 372, 119, 5074,
                664, 6205, 4402, 1443, 6882, 7189, 1725, 680, 4947, 530, 4012, 1000, 4704, 9702,
                8700, 2975
            ]),
            3325536
        );
    }
}
